<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gun Information Form</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        .container {
            width: 60%;
            margin: auto;
            margin-top: 40px;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        table th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
<div th:replace="fragments/sidenav :: sidenav"></div>

<div class="container">
    <h4 class="center-align">Gun Information Form</h4>

    <!-- FORM 1: Generate identifiers -->
    <form th:action="@{/gunForm}" method="post">
        <div class="input-field">
            <input type="text" id="gunName" name="gunName" th:value="${gunName}" required>
            <label for="gunName" class="active" th:if="${gunName != null}">Gun Name</label>
            <label for="gunName" th:if="${gunName == null}">Gun Name</label>
        </div>
        <div class="input-field">
            <input type="text" id="gunModel" name="gunModel" th:value="${gunModel}" required>
            <label for="gunModel" class="active" th:if="${gunModel != null}">Gun Model</label>
            <label for="gunModel" th:if="${gunModel == null}">Gun Model</label>
        </div>
        <div class="input-field">
            <input type="number" id="quantity" name="quantity" min="1" th:value="${quantity}" required>
            <label for="quantity" class="active" th:if="${quantity != null}">Quantity</label>
            <label for="quantity" th:if="${quantity == null}">Quantity</label>
        </div>
        <button type="submit" class="btn">Generate Table</button>
    </form>

    <h5 th:if="${error}" class="red-text center-align" th:text="${error}"></h5>
    <h5 th:if="${success}" class="green-text center-align" th:text="${success}"></h5>

    <!-- FORM 2: Submit detailed gun info -->
    <form th:if="${identifiers != null}" th:action="@{/gunForm/addSpecific}" method="post" style="margin-top: 30px;">
        <!-- Hidden inputs to resend gunName, gunModel, quantity -->
        <input type="hidden" name="gunName" th:value="${gunName}" />
        <input type="hidden" name="gunModel" th:value="${gunModel}" />
        <input type="hidden" name="quantity" th:value="${quantity}" />

        <h5 class="center-align">Gun Information Table</h5>
        <table class="highlight">
            <thead>
            <tr>
                <th>Gun Identifier</th>
                <th>Manufactured Date</th>
                <th>Manufactured Place</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="id, iter : ${identifiers}">
                <td>
                    <input type="text"
                           th:name="'identifiers[' + ${iter.index} + ']'"
                           th:value="${id}"
                           readonly />
                </td>
                <td>
                    <input type="date"
                           th:name="'manufacturedDates[' + ${iter.index} + ']'"
                           required />
                </td>
                <td>
                    <input type="text"
                           th:name="'manufacturedPlaces[' + ${iter.index} + ']'"
                           required />
                </td>
            </tr>
            </tbody>
        </table>
        <button type="submit" class="btn" style="margin-top: 20px;">Submit Guns Information</button>
    </form>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script>M.AutoInit();</script>
</body>
</html>
